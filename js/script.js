

// =========================
// i18n (EN/ES/IT)
// =========================
const I18N = {
  en: {
    // NAV
    "nav.services": "Services",
    "nav.process": "Process",
    "nav.about": "About",
    "nav.quote": "Get a quote",

    // HERO
    "hero.title": "Handcrafted websites<br />for artists & small brands.",
    "hero.subtitle":
      "Built by one person, not an agency. Modern, minimal, and made to convert.",
    "hero.ctaQuote": "Get a quote",
    "hero.fast": "Fast delivery",
    "hero.mobile": "Mobile-first",
    "hero.seo": "SEO-ready",

    // SERVICES
    "services.title": "Services",
    "services.subtitle":
      "Choose your starting point — we’ll tailor it to your brand.",
    "services.launch.title": "Launch Page",
    "services.launch.desc": "1-page site, contact form, basic SEO. 5–7 days.",
    "services.starter.title": "Starter Website",
    "services.starter.desc":
      "3–5 pages, mobile-first, SEO, hosting setup. 10–14 days.",
    "services.creator.title": "Creator Site",
    "services.creator.desc":
      "Portfolio/gallery, embeds, analytics. 14–21 days.",
    "services.getInfo": "Get info",

    // PACKAGES
    "packages.title": "Packages & Details",
    "packages.subtitle":
      "What’s included, timelines, and how we’ll work together.",
    "packages.launch.header": "Launch Page — 1-page site",
    "packages.launch.li1": "Hero, About, Services, Contact form",
    "packages.launch.li2":
      "Mobile-first, fast load, basic SEO (titles, meta, OG)",
    "packages.launch.li3": "1 revision round · Delivery 4–6 days",

    "packages.starter.header": "Starter Website — 3–5 pages",
    "packages.starter.li1": "Home, About, Services, Contact (+ map/form)",
    "packages.starter.li2": "Hosting & domain setup guidance, basic analytics",
    "packages.starter.li3": "2 revision rounds · Delivery 7–10 days",
    "packages.starter.li4": "Add-on: blog or extra page anytime",

    "packages.creator.header": "Creator Site — portfolio or gallery",
    "packages.creator.li1":
      "Portfolio grid or gallery, embeds (YouTube/Spotify)",
    "packages.creator.li2": "Performance tweaks, basic SEO, analytics",
    "packages.creator.li3": "2 revision rounds · Delivery 10–14 days",
    "packages.creator.li4": "Optional: CMS later (Notion/Headless/WordPress)",

    "packages.start": "Start this package",

    // WHY
    "why.title": "Why CraftLab",
    "why.a": "Fast delivery (7–14 days)",
    "why.b": "Built by a developer, not templates",
    "why.c": "Mobile-first & SEO-ready",

    // PROCESS
    "process.title": "Process",
    "process.subtitle": "Simple, clear, and collaborative.",
    "process.s1.title": "Brief & mood",
    "process.s1.desc": "Quick call + examples you love",
    "process.s2.title": "Design draft",
    "process.s2.desc": "Hero, palette, type scale",
    "process.s3.title": "Build & iterate",
    "process.s3.desc": "Responsive, fast, accessible",
    "process.s4.title": "Launch & handoff",
    "process.s4.desc": "Domain, analytics, support",

    // ABOUT
    "about.title": "Studio, not agency.",
    "about.body":
      "CraftLab Studio is a one-person creative lab in Barcelona. I build websites for artists, creators, and small brands. Minimal, fast, and handcrafted — no templates, no fluff.",
    "about.stack": "Stack: HTML · CSS · JavaScript",
    "about.langs": "Languages: EN · ES · IT",
    "about.invoice": "Invoices via cooperative",

    // CONTACT
    "contact.title": "Let’s build something real",
    "contact.subtitle":
      "Tell me about your project. I’ll reply within 24–48 hours.",
    "contact.nameLabel": "Name",
    "contact.emailLabel": "Email",
    "contact.brandLabel": "Brand / Project",
    "contact.budgetLabel": "Budget",
    "contact.messageLabel": "Message",
    "contact.send": "Send",
    "contact.note": "Invoices via cooperative. 50% to start, 50% on delivery.",

    "contact.namePh": "Your name",
    "contact.emailPh": "you@email.com",
    "contact.brandPh": "e.g. DJ booking page",
    "contact.messagePh": "Tell me what you need…",

    "contact.budget.under": "Under €400",
    "contact.budget.mid": "€400–€800",
    "contact.budget.high": "€800–€1,200",
    "contact.budget.plus": "+€1,200",

    "status.sending": "Sending…",
    "status.sent": "✅ Sent! I’ll reply within 24–48 hours.",
    "status.error": "❌ Something went wrong. Try again.",
    "btn.sending": "Sending...",

    // FOOTER
    "footer.tagline": "CraftLab Studio — Built by hand. Designed with soul.",

    // COOKIES PAGE
    "cookies.back": "← Back",
    "cookies.title": "Cookies Policy",
    "cookies.intro": "This website does not use cookies for advertising.",

    "cookies.essential.title": "Essential cookies",
    "cookies.essential.body":
      "If any essential cookies are used by the hosting platform, they are required for basic site functionality.",

    "cookies.analytics.title": "Analytics (optional)",
    "cookies.analytics.body":
      "If analytics tools are enabled in the future (e.g., Google Analytics), this policy will be updated.",

    "cookies.updated": "Last updated:",

    // COOKIES MODAL
    "cookie.title": "Cookies",
    "cookie.body":
      "We use cookies to improve your experience. You can accept all cookies or reject non-essential ones.",
    "cookie.reject": "Reject",
    "cookie.accept": "Accept",

    // PRIVACY
    "privacy.back": "← Back",
    "privacy.title": "Privacy Policy",
    "privacy.intro":
      "CraftLab Studio is a one-person studio. This website collects personal data only when you submit the contact form.",

    "privacy.collect.title": "What data we collect",
    "privacy.collect.li1": "Name",
    "privacy.collect.li2": "Email",
    "privacy.collect.li3": "Message content and optional project details",

    "privacy.why.title": "Why we collect it",
    "privacy.why.body":
      "We use it only to reply to your enquiry and discuss your project.",

    "privacy.retention.title": "Data retention",
    "privacy.retention.body":
      "Messages are kept only as long as needed for communication and project administration.",

    "privacy.third.title": "Third parties",
    "privacy.third.body":
      "The contact form may use an email delivery provider to send messages to our inbox. No marketing lists are used.",

    "privacy.rights.title": "Your rights",
    "privacy.rights.body":
      "You can request access, correction, or deletion of your data by emailing:",

    "privacy.updated": "Last updated:",
  },

  es: {
    "nav.services": "Servicios",
    "nav.process": "Proceso",
    "nav.about": "Sobre mí",
    "nav.quote": "Pedir presupuesto",

    "hero.title": "Webs artesanales<br />para artistas y pequeñas marcas.",
    "hero.subtitle":
      "Hecho por una sola persona, no una agencia. Moderno, minimal y pensado para convertir.",
    "hero.ctaQuote": "Pedir presupuesto",
    "hero.fast": "Entrega rápida",
    "hero.mobile": "Mobile-first",
    "hero.seo": "SEO listo",

    "services.title": "Servicios",
    "services.subtitle": "Elige un punto de partida — lo adaptamos a tu marca.",
    "services.launch.title": "Landing",
    "services.launch.desc":
      "Web de 1 página, formulario de contacto, SEO básico. 5–7 días.",
    "services.starter.title": "Web inicial",
    "services.starter.desc":
      "3–5 páginas, mobile-first, SEO, hosting. 10–14 días.",
    "services.creator.title": "Web para creadores",
    "services.creator.desc":
      "Portfolio/galería, embeds, analítica. 14–21 días.",
    "services.getInfo": "Ver detalles",

    "packages.title": "Paquetes y detalles",
    "packages.subtitle": "Qué incluye, tiempos y cómo trabajaremos.",
    "packages.launch.header": "Landing — web de 1 página",
    "packages.launch.li1": "Hero, Sobre mí, Servicios, Formulario de contacto",
    "packages.launch.li2":
      "Mobile-first, carga rápida, SEO básico (títulos, meta, OG)",
    "packages.launch.li3": "1 ronda de revisiones · Entrega 4–6 días",

    "packages.starter.header": "Web inicial — 3–5 páginas",
    "packages.starter.li1": "Home, Sobre mí, Servicios, Contacto (+ mapa/form)",
    "packages.starter.li2": "Guía de hosting y dominio, analítica básica",
    "packages.starter.li3": "2 rondas de revisiones · Entrega 7–10 días",
    "packages.starter.li4": "Extra: blog o página adicional cuando quieras",

    "packages.creator.header": "Web para creadores — portfolio o galería",
    "packages.creator.li1": "Portfolio o galería, embeds (YouTube/Spotify)",
    "packages.creator.li2": "Optimización, SEO básico, analítica",
    "packages.creator.li3": "2 rondas de revisiones · Entrega 10–14 días",
    "packages.creator.li4":
      "Opcional: CMS más adelante (Notion/Headless/WordPress)",

    "packages.start": "Elegir este paquete",

    "why.title": "Por qué CraftLab",
    "why.a": "Entrega rápida (7–14 días)",
    "why.b": "Hecho por un developer, sin plantillas",
    "why.c": "Mobile-first y SEO listo",

    "process.title": "Proceso",
    "process.subtitle": "Simple, claro y colaborativo.",
    "process.s1.title": "Brief & estilo",
    "process.s1.desc": "Llamada rápida + referencias",
    "process.s2.title": "Boceto de diseño",
    "process.s2.desc": "Hero, paleta, escala tipográfica",
    "process.s3.title": "Construcción & ajustes",
    "process.s3.desc": "Responsive, rápido, accesible",
    "process.s4.title": "Lanzamiento & entrega",
    "process.s4.desc": "Dominio, analítica, soporte",

    "about.title": "Estudio, no agencia.",
    "about.body":
      "CraftLab Studio es un laboratorio creativo de una sola persona en Barcelona. Diseño y desarrollo webs para artistas, creadores y pequeñas marcas. Minimal, rápidas y artesanales — sin plantillas.",
    "about.stack": "Stack: HTML · CSS · JavaScript",
    "about.langs": "Idiomas: EN · ES · IT",
    "about.invoice": "Facturas vía cooperativa",

    "contact.title": "Construyamos algo real",
    "contact.subtitle": "Cuéntame tu proyecto. Respondo en 24–48 horas.",
    "contact.nameLabel": "Nombre",
    "contact.emailLabel": "Email",
    "contact.brandLabel": "Marca / Proyecto",
    "contact.budgetLabel": "Presupuesto",
    "contact.messageLabel": "Mensaje",
    "contact.send": "Enviar",
    "contact.note":
      "Facturas vía cooperativa. 50% al inicio, 50% a la entrega.",

    "contact.namePh": "Tu nombre",
    "contact.emailPh": "tu@email.com",
    "contact.brandPh": "ej. landing para DJ",
    "contact.messagePh": "Cuéntame qué necesitas…",

    "contact.budget.under": "Hasta a €400",
    "contact.budget.mid": "€400–€800",
    "contact.budget.high": "€800–€1.200",
    "contact.budget.plus": "+€1.200",

    "status.sending": "Enviando…",
    "status.sent": "✅ Enviado. Respondo en 24–48 horas.",
    "status.error": "❌ Algo falló. Inténtalo de nuevo.",
    "btn.sending": "Enviando...",

    "footer.tagline": "CraftLab Studio — Hecho a mano. Diseñado con alma.",

    // COOKIES PAGE
    "cookies.back": "← Volver",
    "cookies.title": "Política de Cookies",
    "cookies.intro":
      "Este sitio web no utiliza cookies con fines publicitarios.",

    "cookies.essential.title": "Cookies esenciales",
    "cookies.essential.body":
      "Si la plataforma de alojamiento utiliza cookies esenciales, son necesarias para el funcionamiento básico del sitio.",

    "cookies.analytics.title": "Analítica (opcional)",
    "cookies.analytics.body":
      "Si en el futuro se habilitan herramientas de analítica (por ejemplo, Google Analytics), esta política se actualizará.",

    "cookies.updated": "Última actualización:",

    //MODAL COOKIES
    "cookie.title": "Cookies",
    "cookie.body":
      "Usamos cookies para mejorar tu experiencia. Puedes aceptar todas o rechazar las no esenciales.",
    "cookie.reject": "Rechazar",
    "cookie.accept": "Aceptar",

    // PRIVACY
    "privacy.back": "← Volver",
    "privacy.title": "Política de Privacidad",
    "privacy.intro":
      "CraftLab Studio es un estudio unipersonal. Este sitio web solo recoge datos personales cuando envías el formulario de contacto.",

    "privacy.collect.title": "Qué datos recopilamos",
    "privacy.collect.li1": "Nombre",
    "privacy.collect.li2": "Correo electrónico",
    "privacy.collect.li3":
      "Contenido del mensaje y detalles opcionales del proyecto",

    "privacy.why.title": "Por qué los recopilamos",
    "privacy.why.body":
      "Los utilizamos únicamente para responder a tu consulta y hablar sobre tu proyecto.",

    "privacy.retention.title": "Conservación de los datos",
    "privacy.retention.body":
      "Los mensajes se conservan solo el tiempo necesario para la comunicación y la gestión del proyecto.",

    "privacy.third.title": "Terceros",
    "privacy.third.body":
      "El formulario de contacto puede utilizar un proveedor de envío de correos electrónicos para entregar el mensaje en nuestra bandeja de entrada. No se crean listas de marketing.",

    "privacy.rights.title": "Tus derechos",
    "privacy.rights.body":
      "Puedes solicitar acceso, corrección o eliminación de tus datos escribiendo a:",

    "privacy.updated": "Última actualización:",
  },

  it: {
    "nav.services": "Servizi",
    "nav.process": "Processo",
    "nav.about": "Chi sono",
    "nav.quote": "Richiedi preventivo",

    "hero.title": "Siti web su misura<br />per artisti e piccoli brand.",
    "hero.subtitle":
      "Creato da una sola persona, non da un’agenzia. Moderno, minimal e pensato per convertire.",
    "hero.ctaQuote": "Richiedi preventivo",
    "hero.fast": "Consegna rapida",
    "hero.mobile": "Mobile-first",
    "hero.seo": "SEO pronto",

    "services.title": "Servizi",
    "services.subtitle":
      "Scegli un punto di partenza — lo adattiamo al tuo brand.",
    "services.launch.title": "Landing",
    "services.launch.desc":
      "Sito 1 pagina, form contatto, SEO base. 5–7 giorni.",
    "services.starter.title": "Sito iniziale",
    "services.starter.desc":
      "3–5 pagine, mobile-first, SEO, setup hosting. 10–14 giorni.",
    "services.creator.title": "Sito per creator",
    "services.creator.desc":
      "Portfolio/galleria, embed, analytics. 14–21 giorni.",
    "services.getInfo": "Dettagli",

    "packages.title": "Pacchetti e dettagli",
    "packages.subtitle": "Cosa include, tempi e come lavoreremo insieme.",
    "packages.launch.header": "Landing — sito 1 pagina",
    "packages.launch.li1": "Hero, Chi sono, Servizi, Form contatto",
    "packages.launch.li2": "Mobile-first, veloce, SEO base (titoli, meta, OG)",
    "packages.launch.li3": "1 revisione · Consegna 4–6 giorni",

    "packages.starter.header": "Sito iniziale — 3–5 pagine",
    "packages.starter.li1": "Home, Chi sono, Servizi, Contatto (+ mappa/form)",
    "packages.starter.li2": "Guida hosting e dominio, analytics base",
    "packages.starter.li3": "2 revisioni · Consegna 7–10 giorni",
    "packages.starter.li4": "Extra: blog o pagina aggiuntiva quando vuoi",

    "packages.creator.header": "Sito per creator — portfolio o galleria",
    "packages.creator.li1": "Portfolio/galleria, embed (YouTube/Spotify)",
    "packages.creator.li2": "Ottimizzazioni, SEO base, analytics",
    "packages.creator.li3": "2 revisioni · Consegna 10–14 giorni",
    "packages.creator.li4":
      "Opzionale: CMS più avanti (Notion/Headless/WordPress)",

    "packages.start": "Scegli questo pacchetto",

    "why.title": "Perché CraftLab",
    "why.a": "Consegna rapida (7–14 giorni)",
    "why.b": "Fatto da uno sviluppatore, niente template",
    "why.c": "Mobile-first & SEO pronto",

    "process.title": "Processo",
    "process.subtitle": "Semplice, chiaro e collaborativo.",
    "process.s1.title": "Brief & mood",
    "process.s1.desc": "Call veloce + esempi che ti piacciono",
    "process.s2.title": "Bozza design",
    "process.s2.desc": "Hero, palette, scala tipografica",
    "process.s3.title": "Build & iterazioni",
    "process.s3.desc": "Responsive, veloce, accessibile",
    "process.s4.title": "Lancio & consegna",
    "process.s4.desc": "Dominio, analytics, supporto",

    "about.title": "Studio, non agenzia.",
    "about.body":
      "CraftLab Studio è un laboratorio creativo di una sola persona a Barcellona. Creo siti per artisti, creator e piccoli brand. Minimal, veloci e artigianali — niente template.",
    "about.stack": "Stack: HTML · CSS · JavaScript",
    "about.langs": "Lingue: EN · ES · IT",
    "about.invoice": "Fatture via cooperativa",

    "contact.title": "Costruiamo qualcosa di vero",
    "contact.subtitle": "Parlami del tuo progetto. Rispondo in 24–48 ore.",
    "contact.nameLabel": "Nome",
    "contact.emailLabel": "Email",
    "contact.brandLabel": "Brand / Progetto",
    "contact.budgetLabel": "Budget",
    "contact.messageLabel": "Messaggio",
    "contact.send": "Invia",
    "contact.note":
      "Fatture via cooperativa. 50% all’inizio, 50% alla consegna.",

    "contact.namePh": "Il tuo nome",
    "contact.emailPh": "tu@email.com",
    "contact.brandPh": "es. landing per DJ",
    "contact.messagePh": "Dimmi di cosa hai bisogno…",

    "contact.budget.under": "€400",
    "contact.budget.mid": "€400–€800",
    "contact.budget.high": "€800–€1.200",
    "contact.budget.plus": "+€1.200",

    "status.sending": "Invio…",
    "status.sent": "✅ Inviato! Rispondo in 24–48 ore.",
    "status.error": "❌ Qualcosa è andato storto. Riprova.",
    "btn.sending": "Invio...",

    "footer.tagline": "CraftLab Studio — Fatto a mano. Progettato con anima.",

    // COOKIES PAGE
    "cookies.back": "← Indietro",
    "cookies.title": "Informativa sui Cookie",
    "cookies.intro": "Questo sito web non utilizza cookie per pubblicità.",

    "cookies.essential.title": "Cookie essenziali",
    "cookies.essential.body":
      "Se la piattaforma di hosting utilizza cookie essenziali, sono necessari per il funzionamento di base del sito.",

    "cookies.analytics.title": "Analisi (opzionale)",
    "cookies.analytics.body":
      "Se in futuro verranno attivati strumenti di analisi (ad esempio Google Analytics), questa informativa verrà aggiornata.",

    "cookies.updated": "Ultimo aggiornamento:",

    // MODAL COOKIES
    "cookie.title": "Cookies",
    "cookie.body":
      "Usiamo i cookie per migliorare l’esperienza. Puoi accettare tutto o rifiutare quelli non essenziali.",
    "cookie.reject": "Rifiuta",
    "cookie.accept": "Accetta",

    // PRIVACY
    "privacy.back": "← Indietro",
    "privacy.title": "Informativa sulla Privacy",
    "privacy.intro":
      "CraftLab Studio è uno studio individuale. Questo sito raccoglie dati personali solo quando invii il modulo di contatto.",

    "privacy.collect.title": "Quali dati raccogliamo",
    "privacy.collect.li1": "Nome",
    "privacy.collect.li2": "Email",
    "privacy.collect.li3":
      "Contenuto del messaggio e dettagli opzionali del progetto",

    "privacy.why.title": "Perché li raccogliamo",
    "privacy.why.body":
      "I dati vengono utilizzati esclusivamente per rispondere alla tua richiesta e discutere del tuo progetto.",

    "privacy.retention.title": "Conservazione dei dati",
    "privacy.retention.body":
      "I messaggi vengono conservati solo per il tempo necessario alla comunicazione e alla gestione del progetto.",

    "privacy.third.title": "Terze parti",
    "privacy.third.body":
      "Il modulo di contatto può utilizzare un servizio di invio email per recapitarci il messaggio. Nessuna lista di marketing viene creata.",

    "privacy.rights.title": "I tuoi diritti",
    "privacy.rights.body":
      "Puoi richiedere accesso, modifica o cancellazione dei tuoi dati scrivendo a:",

    "privacy.updated": "Ultimo aggiornamento:",
  },
};

const LANG_KEY = "craftlab_lang";

function applyLang(lang) {
  const dict = I18N[lang] || I18N.en;

  // text/html nodes
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const value = dict[key];
    if (value == null) return;

    // For options, innerHTML is OK but keep it safe
    if (el.tagName === "OPTION") el.textContent = value;
    else el.innerHTML = value;
  });

  // placeholders
  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-i18n-placeholder");
    const value = dict[key];
    if (value == null) return;
    el.setAttribute("placeholder", value);
  });

  // active lang button style
  document.querySelectorAll("[data-lang]").forEach((btn) => {
    const isActive = btn.dataset.lang === lang;
    btn.classList.toggle("btn-accent", isActive);
    btn.classList.toggle("btn-outline-accent", !isActive);
  });

  localStorage.setItem(LANG_KEY, lang);
}

function getApiBase() {
  return "https://craftlab-studio-backend.onrender.com";
}

document.addEventListener("DOMContentLoaded", () => {
  // i18n init
  const savedLang = localStorage.getItem(LANG_KEY) || "en";
  applyLang(savedLang);

  document.querySelectorAll("[data-lang]").forEach((btn) => {
    btn.addEventListener("click", () => applyLang(btn.dataset.lang));
  });

  // Smooth scroll for internal links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", (event) => {
      const targetId = anchor.getAttribute("href");
      if (!targetId || targetId === "#") return;

      const targetEl = document.querySelector(targetId);
      if (!targetEl) return;

      event.preventDefault();
      targetEl.scrollIntoView({ behavior: "smooth" });
    });
  });

  // Reveal-on-scroll
  const revealElements = document.querySelectorAll(".reveal");
  if ("IntersectionObserver" in window) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("show");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.15 }
    );
    revealElements.forEach((el) => observer.observe(el));
  } else {
    revealElements.forEach((el) => el.classList.add("show"));
  }

  // Button micro-press effect
  document
    .querySelectorAll(".btn-accent, .btn-outline-accent")
    .forEach((btn) => {
      btn.addEventListener("mousedown", () => btn.classList.add("btn-press"));
      ["mouseup", "mouseleave"].forEach((ev) =>
        btn.addEventListener(ev, () => btn.classList.remove("btn-press"))
      );
    });

  // Parallax glow 
  const glow = document.querySelector(".neon-glow");
  if (glow) {
    document.addEventListener("mousemove", (e) => {
      const x = (e.clientX / window.innerWidth - 0.5) * 30;
      const y = (e.clientY / window.innerHeight - 0.5) * 15;
      glow.style.transform = `translate(${x}px, ${y}px)`;
    });
  }

  // Cookie modal
  const CONSENT_KEY = "craftlab_cookie_consent"; // "accepted" | "rejected"
  const modalEl = document.getElementById("cookieModal");
  const acceptBtn = document.getElementById("cookieAccept");
  const rejectBtn = document.getElementById("cookieReject");

  if (modalEl && typeof bootstrap !== "undefined") {
    const consent = localStorage.getItem(CONSENT_KEY);
    if (!consent) {
      const modal = bootstrap.Modal.getOrCreateInstance(modalEl, {
        backdrop: "static",
        keyboard: false,
      });
      modal.show();
    }

    const closeModal = () => {
      bootstrap.Modal.getOrCreateInstance(modalEl).hide();
    };

    acceptBtn?.addEventListener("click", () => {
      localStorage.setItem(CONSENT_KEY, "accepted");
      closeModal();
    });

    rejectBtn?.addEventListener("click", () => {
      localStorage.setItem(CONSENT_KEY, "rejected");
      closeModal();
    });
  }

  // Contact form
  const form = document.getElementById("contactForm");
  const statusEl = document.getElementById("contactStatus");
  const btn = document.getElementById("contactBtn");

  if (form) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const lang = localStorage.getItem(LANG_KEY) || "en";
      const dict = I18N[lang] || I18N.en;

      const formData = new FormData(form);
      const payload = Object.fromEntries(formData.entries());

      try {
        if (btn) {
          btn.disabled = true;
          btn.textContent = dict["btn.sending"];
        }
        if (statusEl) {
          statusEl.className = "form-status info mt-2";
          statusEl.textContent = dict["status.sending"];
        }

        const apiBase = getApiBase();
        const res = await fetch(`${apiBase}/api/contact`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data?.error || dict["status.error"]);

        if (statusEl) {
          statusEl.className = "form-status success mt-2";
          statusEl.textContent = dict["status.sent"];
        }

        form.reset();
      } catch (err) {
        console.error(err);
        if (statusEl) {
          statusEl.className = "form-status error mt-2";
          statusEl.textContent = `❌ ${err.message || dict["status.error"]}`;
        }
      } finally {
        if (btn) {
          btn.disabled = false;
          btn.textContent = dict["contact.send"];
        }
      }
    });
  }
});
